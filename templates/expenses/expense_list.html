{% extends "base.html" %}
{% block title %}Expenses{% endblock %}

{% block content %}
<div class="dashboard">
    <header class="dashboard-header">
        <div>
            <h1 class="dashboard-title">Expenses</h1>
            <p class="dashboard-subtitle">All operations that match the filters.</p>
        </div>
        <div>
            <a href="{% url 'expense_create' %}" class="primary-button primary-button-small">
                Add expense
            </a>
        </div>
    </header>

    <!-- Filters (та же форма, что и на Dashboard) -->
    <form method="get" class="auth-form" style="margin-bottom: 18px;">
        <div class="auth-field">
            <label class="auth-label" for="id_bank">Bank</label>
            <select name="bank" id="id_bank" class="auth-input">
                <option value="">All banks</option>
                {% for bank in available_banks %}
                    <option value="{{ bank }}" {% if request.GET.bank == bank %}selected{% endif %}>
                        {{ bank }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <div class="auth-field">
            <label class="auth-label" for="id_currency">Currency</label>
            <select name="currency" id="id_currency" class="auth-input">
                <option value="">All currencies</option>
                {% for cur in available_currencies %}
                    <option value="{{ cur }}" {% if request.GET.currency == cur %}selected{% endif %}>
                        {{ cur }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <div class="auth-field">
            <label class="auth-label" for="id_category">Category</label>
            <select name="category" id="id_category" class="auth-input">
                <option value="">All categories</option>
                {% for cat in categories %}
                    <option value="{{ cat.id }}" {% if request.GET.category == cat.id|stringformat:'s' %}selected{% endif %}>
                        {{ cat.name }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <div class="auth-field">
            <label class="auth-label">Date range</label>
            <div style="display:flex; gap:8px;">
                <input type="date"
                       name="date_from"
                       value="{{ request.GET.date_from }}"
                       class="auth-input"
                       style="flex:1;">
                <input type="date"
                       name="date_to"
                       value="{{ request.GET.date_to }}"
                       class="auth-input"
                       style="flex:1;">
            </div>
        </div>

        <button type="submit" class="primary-button primary-button-small">
            Apply filters
        </button>
        <a href="{% url 'expense_list' %}" class="secondary-link">Reset</a>
        <a href="{% url 'statement_import' %}" class="secondary-link">Import statement</a>
    </form>

    {% if expenses %}
        <div style="overflow-x:auto;">
            <table style="width:100%; border-collapse:collapse; font-size:14px;">
                <thead>
                    <tr style="text-align:left; border-bottom:1px solid rgba(148,163,184,0.3);">
                        <th style="padding:6px 4px;">Date</th>
                        <th style="padding:6px 4px;">Description</th>
                        <th style="padding:6px 4px;">Category</th>
                        <th style="padding:6px 4px;">Bank</th>
                        <th style="padding:6px 4px; text-align:right;">Amount</th>
                        <th style="padding:6px 4px;"></th>
                    </tr>
                </thead>
                <tbody>
                    {% for exp in expenses %}
                        <tr style="border-bottom:1px solid rgba(243,244,246,1);">
                            <td style="padding:6px 4px; white-space:nowrap;">{{ exp.date }}</td>
                            <td style="padding:6px 4px;">{{ exp.description }}</td>
                            <td style="padding:6px 4px;">{{ exp.category.name|default:"—" }}</td>
                            <td style="padding:6px 4px;">{{ exp.bank|default:"—" }}</td>
                            <td style="padding:6px 4px; text-align:right;">
                                {{ exp.amount }} {{ exp.currency }}
                            </td>
                            <td style="padding:6px 4px; text-align:right; white-space:nowrap;">
                                <a href="{% url 'expense_update' exp.pk %}" class="secondary-link">Edit</a>
                                <a href="{% url 'expense_delete' exp.pk %}" class="secondary-link">Delete</a>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        {% if is_paginated %}
            <div style="margin-top:12px; font-size:13px;">
                {% if page_obj.has_previous %}
                    <a href="?page={{ page_obj.previous_page_number }}" class="secondary-link">Previous</a>
                {% endif %}
                <span>Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
                {% if page_obj.has_next %}
                    <a href="?page={{ page_obj.next_page_number }}" class="secondary-link">Next</a>
                {% endif %}
            </div>
        {% endif %}
    {% else %}
        <section class="dashboard-empty">
            <h2 class="dashboard-empty-title">No expenses found.</h2>
            <p class="dashboard-empty-text">
                Try changing filters or import a new statement.
            </p>
        </section>
    {% endif %}
</div>
{% endblock %}
